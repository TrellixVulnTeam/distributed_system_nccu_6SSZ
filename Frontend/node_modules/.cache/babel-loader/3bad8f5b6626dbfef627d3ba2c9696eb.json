{"remainingRequest":"C:\\Users\\Graham\\Desktop\\frontend\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\Graham\\Desktop\\frontend\\node_modules\\eslint-loader\\index.js??ref--13-0!C:\\Users\\Graham\\Desktop\\frontend\\src\\api\\interceptor.js","dependencies":[{"path":"C:\\Users\\Graham\\Desktop\\frontend\\src\\api\\interceptor.js","mtime":1620662185000},{"path":"C:\\Users\\Graham\\Desktop\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1621157932554},{"path":"C:\\Users\\Graham\\Desktop\\frontend\\node_modules\\babel-loader\\lib\\index.js","mtime":1621157932471},{"path":"C:\\Users\\Graham\\Desktop\\frontend\\node_modules\\eslint-loader\\index.js","mtime":1621157947701}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LnRvLXN0cmluZyI7CmltcG9ydCAicmVnZW5lcmF0b3ItcnVudGltZS9ydW50aW1lIjsKaW1wb3J0IF9hc3luY1RvR2VuZXJhdG9yIGZyb20gIkM6L1VzZXJzL0dyYWhhbS9EZXNrdG9wL2Zyb250ZW5kL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9hc3luY1RvR2VuZXJhdG9yIjsKaW1wb3J0IHN0b3JlIGZyb20gJy4uL3N0b3JlJzsKaW1wb3J0IHJvdXRlciBmcm9tICcuLi9yb3V0ZXInOwpleHBvcnQgZnVuY3Rpb24gc2V0SW50ZXJjZXB0b3IoYXhpb3NJbnN0YW5jZSkgewogIGF4aW9zSW5zdGFuY2UuaW50ZXJjZXB0b3JzLnJlcXVlc3QudXNlKGZ1bmN0aW9uIChjb25maWcpIHsKICAgIHZhciB0b2tlbiA9IHN0b3JlLnN0YXRlLnVzZXIudG9rZW47CgogICAgaWYgKHRva2VuKSB7CiAgICAgIGNvbmZpZy5oZWFkZXJzWyd0b2tlbiddID0gdG9rZW47CiAgICB9CgogICAgcmV0dXJuIGNvbmZpZzsKICB9LCBmdW5jdGlvbiAoZXJyb3IpIHsKICAgIHJldHVybiBQcm9taXNlLnJlamVjdChlcnJvcik7CiAgfSk7CiAgYXhpb3NJbnN0YW5jZS5pbnRlcmNlcHRvcnMucmVzcG9uc2UudXNlKCAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkgewogICAgdmFyIF9yZWYgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUocmVzcG9uc2UpIHsKICAgICAgdmFyIHJlc3VsdDsKICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUkKF9jb250ZXh0KSB7CiAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQucHJldiA9IF9jb250ZXh0Lm5leHQpIHsKICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgIHJlc3VsdCA9IHJlc3BvbnNlLmRhdGEucmVzdWx0OwoKICAgICAgICAgICAgICBpZiAoIShyZXN1bHQuc3RhdHVzID09PSAnZmFpbCcpKSB7CiAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMTE7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSA0OwogICAgICAgICAgICAgIHJldHVybiBzdG9yZS5kaXNwYXRjaCgncG9wdXAvdXBkYXRlUG9wdXAnLCB7CiAgICAgICAgICAgICAgICBwb3B1cFRleHQ6IHJlc3VsdC5lcnIsCiAgICAgICAgICAgICAgICBpbWdTcmM6ICcvaW1nL2Rpc3R1cmIuc3ZnJwogICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgIGlmICghKHJlc3VsdC5lcnIgPT09ICfoq4vph43mlrDnmbvlhaUnKSkgewogICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSA3OwogICAgICAgICAgICAgIHJldHVybiBzdG9yZS5kaXNwYXRjaCgndXNlci9sb2dvdXQnKTsKCiAgICAgICAgICAgIGNhc2UgNzoKICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gOTsKICAgICAgICAgICAgICByZXR1cm4gcm91dGVyLnB1c2goJy9sb2dpbicpOwoKICAgICAgICAgICAgY2FzZSA5OgogICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAxNjsKICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgMTE6CiAgICAgICAgICAgICAgaWYgKCEoc3RvcmUuc3RhdGUudXNlci50b2tlbiA9PT0gbnVsbCkpIHsKICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAxNjsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDE0OwogICAgICAgICAgICAgIHJldHVybiBzdG9yZS5kaXNwYXRjaCgndXNlci9sb2dpbicsIHsKICAgICAgICAgICAgICAgIHRva2VuOiByZXN1bHQudG9rZW4sCiAgICAgICAgICAgICAgICByb2xlOiByZXN1bHQuaWRlbnRpdHkKICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGNhc2UgMTQ6CiAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDE2OwogICAgICAgICAgICAgIHJldHVybiByb3V0ZXIucHVzaCgiLyIuY29uY2F0KHJlc3VsdC5pZGVudGl0eSkpOwoKICAgICAgICAgICAgY2FzZSAxNjoKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuYWJydXB0KCJyZXR1cm4iLCByZXN1bHQpOwoKICAgICAgICAgICAgY2FzZSAxNzoKICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuc3RvcCgpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwgX2NhbGxlZSk7CiAgICB9KSk7CgogICAgcmV0dXJuIGZ1bmN0aW9uIChfeCkgewogICAgICByZXR1cm4gX3JlZi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgfTsKICB9KCksIC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7CiAgICB2YXIgX3JlZjIgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUyKGVycm9yKSB7CiAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMiQoX2NvbnRleHQyKSB7CiAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQyLnByZXYgPSBfY29udGV4dDIubmV4dCkgewogICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5hYnJ1cHQoInJldHVybiIsIFByb21pc2UucmVqZWN0KGVycm9yKSk7CgogICAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5zdG9wKCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LCBfY2FsbGVlMik7CiAgICB9KSk7CgogICAgcmV0dXJuIGZ1bmN0aW9uIChfeDIpIHsKICAgICAgcmV0dXJuIF9yZWYyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICB9OwogIH0oKSk7Cn0="},{"version":3,"sources":["C:/Users/Graham/Desktop/frontend/src/api/interceptor.js"],"names":["store","router","setInterceptor","axiosInstance","interceptors","request","use","config","token","state","user","headers","error","Promise","reject","response","result","data","status","dispatch","popupText","err","imgSrc","push","role","identity"],"mappings":";;;AAAA,OAAOA,KAAP,MAAkB,UAAlB;AACA,OAAOC,MAAP,MAAmB,WAAnB;AAEA,OAAO,SAASC,cAAT,CAAwBC,aAAxB,EAAuC;AAC1CA,EAAAA,aAAa,CAACC,YAAd,CAA2BC,OAA3B,CAAmCC,GAAnC,CACI,UAACC,MAAD,EAAY;AACR,QAAMC,KAAK,GAAGR,KAAK,CAACS,KAAN,CAAYC,IAAZ,CAAiBF,KAA/B;;AACA,QAAIA,KAAJ,EAAW;AACPD,MAAAA,MAAM,CAACI,OAAP,CAAe,OAAf,IAA0BH,KAA1B;AACH;;AACD,WAAOD,MAAP;AACH,GAPL,EAQI,UAACK,KAAD,EAAW;AACP,WAAOC,OAAO,CAACC,MAAR,CAAeF,KAAf,CAAP;AACH,GAVL;AAYAT,EAAAA,aAAa,CAACC,YAAd,CAA2BW,QAA3B,CAAoCT,GAApC;AAAA,uEACI,iBAAOS,QAAP;AAAA;AAAA;AAAA;AAAA;AAAA;AACUC,cAAAA,MADV,GACmBD,QAAQ,CAACE,IAAT,CAAcD,MADjC;;AAAA,oBAGQA,MAAM,CAACE,MAAP,KAAkB,MAH1B;AAAA;AAAA;AAAA;;AAAA;AAAA,qBAIclB,KAAK,CAACmB,QAAN,CAAe,mBAAf,EAAoC;AACtCC,gBAAAA,SAAS,EAAEJ,MAAM,CAACK,GADoB;AAEtCC,gBAAAA,MAAM,EAAE;AAF8B,eAApC,CAJd;;AAAA;AAAA,oBASYN,MAAM,CAACK,GAAP,KAAe,OAT3B;AAAA;AAAA;AAAA;;AAAA;AAAA,qBAUkBrB,KAAK,CAACmB,QAAN,CAAe,aAAf,CAVlB;;AAAA;AAAA;AAAA,qBAWkBlB,MAAM,CAACsB,IAAP,CAAY,QAAZ,CAXlB;;AAAA;AAAA;AAAA;;AAAA;AAAA,oBAcYvB,KAAK,CAACS,KAAN,CAAYC,IAAZ,CAAiBF,KAAjB,KAA2B,IAdvC;AAAA;AAAA;AAAA;;AAAA;AAAA,qBAekBR,KAAK,CAACmB,QAAN,CAAe,YAAf,EAA6B;AAC/BX,gBAAAA,KAAK,EAAEQ,MAAM,CAACR,KADiB;AAE/BgB,gBAAAA,IAAI,EAAER,MAAM,CAACS;AAFkB,eAA7B,CAflB;;AAAA;AAAA;AAAA,qBAmBkBxB,MAAM,CAACsB,IAAP,YAAgBP,MAAM,CAACS,QAAvB,EAnBlB;;AAAA;AAAA,+CAuBWT,MAvBX;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KADJ;;AAAA;AAAA;AAAA;AAAA;AAAA,wEA0BI,kBAAOJ,KAAP;AAAA;AAAA;AAAA;AAAA;AAAA,gDACWC,OAAO,CAACC,MAAR,CAAeF,KAAf,CADX;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KA1BJ;;AAAA;AAAA;AAAA;AAAA;AA8BH","sourcesContent":["import store from '../store';\r\nimport router from '../router';\r\n\r\nexport function setInterceptor(axiosInstance) {\r\n    axiosInstance.interceptors.request.use(\r\n        (config) => {\r\n            const token = store.state.user.token;\r\n            if (token) {\r\n                config.headers['token'] = token;\r\n            }\r\n            return config;\r\n        },\r\n        (error) => {\r\n            return Promise.reject(error);\r\n        }\r\n    );\r\n    axiosInstance.interceptors.response.use(\r\n        async (response) => {\r\n            const result = response.data.result;\r\n\r\n            if (result.status === 'fail') {\r\n                await store.dispatch('popup/updatePopup', {\r\n                    popupText: result.err,\r\n                    imgSrc: '/img/disturb.svg',\r\n                });\r\n\r\n                if (result.err === '請重新登入') {\r\n                    await store.dispatch('user/logout');\r\n                    await router.push('/login');\r\n                }\r\n            } else {\r\n                if (store.state.user.token === null) {\r\n                    await store.dispatch('user/login', {\r\n                        token: result.token,\r\n                        role: result.identity,\r\n                    });\r\n                    await router.push(`/${result.identity}`);\r\n                }\r\n            }\r\n\r\n            return result;\r\n        },\r\n        async (error) => {\r\n            return Promise.reject(error);\r\n        }\r\n    );\r\n}\r\n"]}]}